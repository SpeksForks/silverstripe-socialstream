/*!
 * jQuery Lifestream Plug-in extensions
 * - Support for twitter hashtags
 * - Custom backend controller
 * - Facebook pages are working again
 */
!function(t){var e=function(e){var r=function(e){return e.replace(/([a-z]+:\/\/)([-A-Z0-9+&@#\/%?=~_|(\)!:,.;]*[-A-Z0-9+&@#\/%=~_|(\)])/gi,function(e,r,a){return t("<a></a>").attr("target","_blank").attr("href",e).text(a.length>35?a.substr(0,34)+"...":a)[0].outerHTML})},a=function(e){return e.replace(/<a.*?<\/a>|(^|\r?\n|\r|\n|)(#|\$)([a-zA-Z0-9ÅåÄäÖöØøÆæÉéÈèÜüÊêÛûÎî_]+)(\r?\n|\r|\n||$)/g,function(e,r,a,n,s){if(void 0===n)return e
var o=""
return"#"==a&&(o=t("<a></a>").attr("href","https://www.facebook.com/hashtag/"+n).attr("target","_blank").text("#"+n)[0].outerHTML),r+o+s})}
return a(r(e))},r=function(e){var r=function(e){return e.replace(/([a-z]+:\/\/)([-A-Z0-9+&@#\/%?=~_|(\)!:,.;]*[-A-Z0-9+&@#\/%=~_|(\)])/gi,function(e,r,a){return t("<a></a>").attr("href",e).attr("target","_blank").text(a.length>35?a.substr(0,34)+"...":a)[0].outerHTML})},a=function(e){return e.replace(/(^|[^\w]+)\@([a-zA-Z0-9_]{1,15})/g,function(e,r,a){var n=t("<a></a>").attr("href","https://twitter.com/"+a).attr("target","_blank").text("@"+a)[0].outerHTML
return r+n})},n=function(e){return e.replace(/<a.*?<\/a>|(^|\r?\n|\r|\n|)(#|\$)([a-zA-Z0-9ÅåÄäÖöØøÆæÉéÈèÜüÊêÛûÎî_]+)(\r?\n|\r|\n||$)/g,function(e,r,a,n,s){if(void 0===n)return e
var o=""
return"#"==a?o=t("<a></a>").attr("href","https://twitter.com/hashtag/"+n+"?src=hash").attr("target","_blank").text("#"+n)[0].outerHTML:"$"==a&&(o=t("<a></a>").attr("href","https://twitter.com/search?q=%24"+n+"&src=hash").attr("target","_blank").text("$"+n)[0].outerHTML),r+o+s})}
return n(a(r(e)))}
t.fn.lifestream.feeds.facebook_page=function(r,a){var n=t.extend({},{facebook_post:"{{html text}}"},r.template),s=function(s){if(s){var o,u,c=[],i=0
if(s.posts&&s.posts.length>0)for(o=s.posts,u=o.length;u>i;i++){var f=o[i]
t.trim(f.text)&&c.push({date:new Date(1e3*f.createdAt),config:r,html:t.tmpl(n.facebook_post,{text:e(t("<div/>").html(f.text).text())})})}a(c)}}
return t.ajax({url:"/socialstream/facebook_page/?query="+encodeURIComponent(r.user),cache:!1}).success(s),{template:n}},t.fn.lifestream.feeds.twitter=function(e,a){var n=t.extend({},{posted:"{{html tweet}}"},e.template),s=function(s){var o=[]
if(!s.tweets)return o
for(var u=0;u<s.tweets.length;u++){var c=s.tweets[u]
o.push({date:new Date(1e3*c.createdAt),config:e,html:t.tmpl(n.posted,{tweet:r(t("<div/>").html(c.text).text()),complete_url:"https://twitter.com/"+e.user+"/status/"+c.id}),url:"https://twitter.com/"+e.user})}a(o)}
return t.ajax({url:"/socialstream/twitter_user/?query="+encodeURIComponent(e.user),cache:!1}).success(s),{template:n}},t.fn.lifestream.feeds.twitter_hashtag=function(e,a){var n=t.extend({},{posted:"{{html tweet}}"},e.template),s=function(s){var o=[]
if(!s.tweets)return o
for(var u=0;u<s.tweets.length;u++){var c=s.tweets[u]
o.push({date:new Date(1e3*c.createdAt),config:e,html:t.tmpl(n.posted,{tweet:r(t("<div/>").html(c.text).text()),complete_url:"https://twitter.com/"+e.user+"/status/"+c.id}),url:"https://twitter.com/"+e.user})}a(o)}
return t.ajax({url:"/socialstream/twitter_search/?query="+encodeURIComponent("#"+e.user),cache:!1}).success(s),{template:n}}}(jQuery)