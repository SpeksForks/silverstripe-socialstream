/*!
 * jQuery Lifestream Plug-in extensions
 * - Support for twitter hashtags
 * - Custom backend controller
 * - Facebook pages are working again
 */
!function(a){var b=function(b){var c=function(b){return b.replace(/([a-z]+:\/\/)([-A-Z0-9+&@#\/%?=~_|(\)!:,.;]*[-A-Z0-9+&@#\/%=~_|(\)])/gi,function(b,c,d){return a("<a></a>").attr("target","_blank").attr("href",b).text(d.length>35?d.substr(0,34)+"...":d)[0].outerHTML})},d=function(b){return b.replace(/<a.*?<\/a>|(^|\r?\n|\r|\n|)(#|\$)([a-zA-Z0-9\xc5\xe5\xc4\xe4\xd6\xf6\xd8\xf8\xc6\xe6\xc9\xe9\xc8\xe8\xdc\xfc\xca\xea\xdb\xfb\xce\xee_]+)(\r?\n|\r|\n||$)/g,function(b,c,d,e,f){if("undefined"==typeof e)return b;var g="";return"#"==d&&(g=a("<a></a>").attr("href","https://www.facebook.com/hashtag/"+e).attr("target","_blank").text("#"+e)[0].outerHTML),c+g+f})};return d(c(b))},c=function(b){var c=function(b){return b.replace(/([a-z]+:\/\/)([-A-Z0-9+&@#\/%?=~_|(\)!:,.;]*[-A-Z0-9+&@#\/%=~_|(\)])/gi,function(b,c,d){return a("<a></a>").attr("href",b).attr("target","_blank").text(d.length>35?d.substr(0,34)+"...":d)[0].outerHTML})},d=function(b){return b.replace(/(^|[^\w]+)\@([a-zA-Z0-9_]{1,15})/g,function(b,c,d){var e=a("<a></a>").attr("href","https://twitter.com/"+d).attr("target","_blank").text("@"+d)[0].outerHTML;return c+e})},e=function(b){return b.replace(/<a.*?<\/a>|(^|\r?\n|\r|\n|)(#|\$)([a-zA-Z0-9\xc5\xe5\xc4\xe4\xd6\xf6\xd8\xf8\xc6\xe6\xc9\xe9\xc8\xe8\xdc\xfc\xca\xea\xdb\xfb\xce\xee_]+)(\r?\n|\r|\n||$)/g,function(b,c,d,e,f){if("undefined"==typeof e)return b;var g="";return"#"==d?g=a("<a></a>").attr("href","https://twitter.com/hashtag/"+e+"?src=hash").attr("target","_blank").text("#"+e)[0].outerHTML:"$"==d&&(g=a("<a></a>").attr("href","https://twitter.com/search?q=%24"+e+"&src=hash").attr("target","_blank").text("$"+e)[0].outerHTML),c+g+f})};return e(d(c(b)))};a.fn.lifestream.feeds.facebook_page=function(c,d){var e=a.extend({},{facebook_post:"{{html text}}"},c.template),f=function(f){if(f){var h,j,g=[],i=0;if(f.posts&&f.posts.length>0)for(h=f.posts,j=h.length;j>i;i++){var k=h[i];if(a.trim(k.text)){var l=k.text;l.length>255&&(l=l.substr(0,255)+"...",l=l.substr(0,Math.min(l.length,l.lastIndexOf(" ")))),g.push({date:new Date(1e3*k.createdAt),config:c,html:a.tmpl(e.facebook_post,{text:b(a("<div/>").html(l).text())})})}}d(g)}};return a.ajax({url:"/socialstream/facebook_page/?query="+encodeURIComponent(c.user),cache:!1}).success(f),{template:e}},a.fn.lifestream.feeds.twitter=function(b,d){var e=a.extend({},{posted:"{{html tweet}}"},b.template),f=function(f){var g=[];if(!f.tweets)return g;for(var h=0;h<f.tweets.length;h++){var i=f.tweets[h];g.push({date:new Date(1e3*i.createdAt),config:b,html:a.tmpl(e.posted,{tweet:c(a("<div/>").html(i.text).text()),complete_url:"https://twitter.com/"+b.user+"/status/"+i.id}),url:"https://twitter.com/"+b.user})}d(g)};return a.ajax({url:"/socialstream/twitter_user/?query="+encodeURIComponent(b.user),cache:!1}).success(f),{template:e}},a.fn.lifestream.feeds.twitter_hashtag=function(b,d){var e=a.extend({},{posted:"{{html tweet}}"},b.template),f=function(f){var g=[];if(!f.tweets)return g;for(var h=0;h<f.tweets.length;h++){var i=f.tweets[h];g.push({date:new Date(1e3*i.createdAt),config:b,html:a.tmpl(e.posted,{tweet:c(a("<div/>").html(i.text).text()),complete_url:"https://twitter.com/"+b.user+"/status/"+i.id}),url:"https://twitter.com/"+b.user})}d(g)};return a.ajax({url:"/socialstream/twitter_search/?query="+encodeURIComponent("#"+b.user),cache:!1}).success(f),{template:e}}}(jQuery);